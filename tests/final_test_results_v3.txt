============================= test session starts =============================
platform win32 -- Python 3.12.10, pytest-9.0.2, pluggy-1.6.0 -- D:\Project\PEOPLE_OS\venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: D:\Project\PEOPLE_OS
configfile: pytest.ini
plugins: anyio-3.7.1, asyncio-1.3.0, cov-7.0.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 277 items

backend/tests/test_department_crud.py::TestDepartmentCreation::test_create_department_basic PASSED [  0%]
backend/tests/test_department_crud.py::TestDepartmentCreation::test_create_department_basic ERROR [  0%]
backend/tests/test_department_crud.py::TestDepartmentCreation::test_create_department_with_description ERROR [  0%]
backend/tests/test_department_crud.py::TestDepartmentCreation::test_create_department_with_description ERROR [  0%]
backend/tests/test_department_crud.py::TestDepartmentCreation::test_create_subdepartment ERROR [  1%]
backend/tests/test_department_crud.py::TestDepartmentCreation::test_create_subdepartment ERROR [  1%]
backend/tests/test_department_crud.py::TestDepartmentCreation::test_create_nested_subdepartments ERROR [  1%]
backend/tests/test_department_crud.py::TestDepartmentCreation::test_create_nested_subdepartments ERROR [  1%]
backend/tests/test_department_crud.py::TestDepartmentCreation::test_create_multiple_departments_same_org ERROR [  1%]
backend/tests/test_department_crud.py::TestDepartmentCreation::test_create_multiple_departments_same_org ERROR [  1%]
backend/tests/test_department_crud.py::TestDepartmentCreation::test_department_unique_per_organization ERROR [  2%]
backend/tests/test_department_crud.py::TestDepartmentCreation::test_department_unique_per_organization ERROR [  2%]
backend/tests/test_department_crud.py::TestDepartmentRetrieval::test_retrieve_department_by_id ERROR [  2%]
backend/tests/test_department_crud.py::TestDepartmentRetrieval::test_retrieve_department_by_id ERROR [  2%]
backend/tests/test_department_crud.py::TestDepartmentRetrieval::test_retrieve_all_departments_in_org ERROR [  2%]
backend/tests/test_department_crud.py::TestDepartmentRetrieval::test_retrieve_all_departments_in_org ERROR [  2%]
backend/tests/test_department_crud.py::TestDepartmentRetrieval::test_retrieve_department_not_found PASSED [  3%]
backend/tests/test_department_crud.py::TestDepartmentRetrieval::test_retrieve_department_not_found ERROR [  3%]
backend/tests/test_department_crud.py::TestDepartmentRetrieval::test_retrieve_subdepartments ERROR [  3%]
backend/tests/test_department_crud.py::TestDepartmentRetrieval::test_retrieve_subdepartments ERROR [  3%]
backend/tests/test_department_crud.py::TestDepartmentRetrieval::test_retrieve_department_with_employees ERROR [  3%]
backend/tests/test_department_crud.py::TestDepartmentRetrieval::test_retrieve_department_with_employees ERROR [  3%]
backend/tests/test_department_crud.py::TestDepartmentUpdate::test_update_department_name ERROR [  4%]
backend/tests/test_department_crud.py::TestDepartmentUpdate::test_update_department_name ERROR [  4%]
backend/tests/test_department_crud.py::TestDepartmentUpdate::test_update_department_code ERROR [  4%]
backend/tests/test_department_crud.py::TestDepartmentUpdate::test_update_department_code ERROR [  4%]
backend/tests/test_department_crud.py::TestDepartmentUpdate::test_update_department_description ERROR [  5%]
backend/tests/test_department_crud.py::TestDepartmentUpdate::test_update_department_description ERROR [  5%]
backend/tests/test_department_crud.py::TestDepartmentDelete::test_delete_empty_department ERROR [  5%]
backend/tests/test_department_crud.py::TestDepartmentDelete::test_delete_empty_department ERROR [  5%]
backend/tests/test_department_crud.py::TestDepartmentDelete::test_delete_department_cascade_check ERROR [  5%]
backend/tests/test_department_crud.py::TestDepartmentDelete::test_delete_department_cascade_check ERROR [  5%]
backend/tests/test_department_crud.py::TestDepartmentErrorHandling::test_missing_required_organization PASSED [  6%]
backend/tests/test_department_crud.py::TestDepartmentErrorHandling::test_missing_required_organization ERROR [  6%]
backend/tests/test_department_crud.py::TestDepartmentErrorHandling::test_invalid_parent_subdepartment PASSED [  6%]
backend/tests/test_department_crud.py::TestDepartmentErrorHandling::test_invalid_parent_subdepartment ERROR [  6%]
backend/tests/test_department_crud.py::TestDepartmentErrorHandling::test_department_unicode_name ERROR [  6%]
backend/tests/test_department_crud.py::TestDepartmentErrorHandling::test_department_unicode_name ERROR [  6%]
backend/tests/test_department_crud.py::TestDepartmentErrorHandling::test_circular_subdepartment_reference ERROR [  7%]
backend/tests/test_department_crud.py::TestDepartmentErrorHandling::test_circular_subdepartment_reference ERROR [  7%]
backend/tests/test_job_levels_grades.py::TestJobLevelCreation::test_create_job_level_basic PASSED [  7%]
backend/tests/test_job_levels_grades.py::TestJobLevelCreation::test_create_job_level_basic ERROR [  7%]
backend/tests/test_job_levels_grades.py::TestJobLevelCreation::test_create_job_level_hierarchy ERROR [  7%]
backend/tests/test_job_levels_grades.py::TestJobLevelCreation::test_create_job_level_hierarchy ERROR [  7%]
backend/tests/test_job_levels_grades.py::TestJobLevelCreation::test_retrieve_job_level_by_number ERROR [  8%]
backend/tests/test_job_levels_grades.py::TestJobLevelCreation::test_retrieve_job_level_by_number ERROR [  8%]
backend/tests/test_job_levels_grades.py::TestJobLevelCreation::test_job_level_numeric_order ERROR [  8%]
backend/tests/test_job_levels_grades.py::TestJobLevelCreation::test_job_level_numeric_order ERROR [  8%]
backend/tests/test_job_levels_grades.py::TestGradeCreation::test_create_grade_basic ERROR [  9%]
backend/tests/test_job_levels_grades.py::TestGradeCreation::test_create_grade_basic ERROR [  9%]
backend/tests/test_job_levels_grades.py::TestGradeCreation::test_create_multiple_grades ERROR [  9%]
backend/tests/test_job_levels_grades.py::TestGradeCreation::test_create_multiple_grades ERROR [  9%]
backend/tests/test_job_levels_grades.py::TestGradeCreation::test_retrieve_grade_by_level ERROR [  9%]
backend/tests/test_job_levels_grades.py::TestGradeCreation::test_retrieve_grade_by_level ERROR [  9%]
backend/tests/test_job_levels_grades.py::TestGradeCreation::test_grade_organization_isolation ERROR [ 10%]
backend/tests/test_job_levels_grades.py::TestGradeCreation::test_grade_organization_isolation ERROR [ 10%]
backend/tests/test_job_levels_grades.py::TestDesignationCreation::test_create_designation_basic ERROR [ 10%]
backend/tests/test_job_levels_grades.py::TestDesignationCreation::test_create_designation_basic ERROR [ 10%]
backend/tests/test_job_levels_grades.py::TestDesignationCreation::test_create_designation_with_levels ERROR [ 10%]
backend/tests/test_job_levels_grades.py::TestDesignationCreation::test_create_designation_with_levels ERROR [ 10%]
backend/tests/test_job_levels_grades.py::TestDesignationCreation::test_retrieve_designation_by_department ERROR [ 11%]
backend/tests/test_job_levels_grades.py::TestDesignationCreation::test_retrieve_designation_by_department ERROR [ 11%]
backend/tests/test_job_levels_grades.py::TestDesignationCreation::test_designation_grade_relationship ERROR [ 11%]
backend/tests/test_job_levels_grades.py::TestDesignationCreation::test_designation_grade_relationship ERROR [ 11%]
backend/tests/test_job_levels_grades.py::TestJobDesignationRelationships::test_designation_requires_grade ERROR [ 11%]
backend/tests/test_job_levels_grades.py::TestJobDesignationRelationships::test_designation_requires_grade ERROR [ 11%]
backend/tests/test_job_levels_grades.py::TestJobDesignationRelationships::test_designation_requires_department ERROR [ 12%]
backend/tests/test_job_levels_grades.py::TestJobDesignationRelationships::test_designation_requires_department ERROR [ 12%]
backend/tests/test_job_levels_grades.py::TestJobDesignationRelationships::test_employee_with_designation ERROR [ 12%]
backend/tests/test_job_levels_grades.py::TestJobDesignationRelationships::test_employee_with_designation ERROR [ 12%]
backend/tests/test_job_levels_grades.py::TestJobDesignationRelationships::test_job_level_grade_mapping ERROR [ 12%]
backend/tests/test_job_levels_grades.py::TestJobDesignationRelationships::test_job_level_grade_mapping ERROR [ 12%]
backend/tests/test_job_levels_grades.py::TestJobDesignationErrorHandling::test_duplicate_designation_code ERROR [ 13%]
backend/tests/test_job_levels_grades.py::TestJobDesignationErrorHandling::test_duplicate_designation_code ERROR [ 13%]
backend/tests/test_job_levels_grades.py::TestJobDesignationErrorHandling::test_negative_grade_level ERROR [ 13%]
backend/tests/test_job_levels_grades.py::TestJobDesignationErrorHandling::test_negative_grade_level ERROR [ 13%]
backend/tests/test_job_levels_grades.py::TestJobDesignationErrorHandling::test_zero_job_level_number ERROR [ 14%]
backend/tests/test_job_levels_grades.py::TestJobDesignationErrorHandling::test_zero_job_level_number ERROR [ 14%]
backend/tests/test_job_levels_grades.py::TestJobDesignationErrorHandling::test_very_long_designation_name ERROR [ 14%]
backend/tests/test_job_levels_grades.py::TestJobDesignationErrorHandling::test_very_long_designation_name ERROR [ 14%]
backend/tests/test_job_levels_grades.py::TestJobDesignationErrorHandling::test_special_characters_in_code ERROR [ 14%]
backend/tests/test_job_levels_grades.py::TestJobDesignationErrorHandling::test_special_characters_in_code ERROR [ 14%]
backend/tests/test_security_phase2.py::TestJWTTokenGeneration::test_create_access_token PASSED [ 15%]
backend/tests/test_security_phase2.py::TestJWTTokenGeneration::test_create_refresh_token PASSED [ 15%]
backend/tests/test_security_phase2.py::TestJWTTokenGeneration::test_access_token_contains_user_data PASSED [ 15%]
backend/tests/test_security_phase2.py::TestJWTTokenGeneration::test_token_has_expiration PASSED [ 16%]
backend/tests/test_security_phase2.py::TestJWTTokenGeneration::test_token_type_validation PASSED [ 16%]
backend/tests/test_security_phase2.py::TestTokenRefresh::test_refresh_access_token PASSED [ 16%]
backend/tests/test_security_phase2.py::TestTokenRefresh::test_new_access_token_valid PASSED [ 17%]
backend/tests/test_security_phase2.py::TestTokenRefresh::test_invalid_refresh_token_rejected PASSED [ 17%]
backend/tests/test_security_phase2.py::TestRoleDefinitions::test_all_roles_defined PASSED [ 18%]
backend/tests/test_security_phase2.py::TestRoleDefinitions::test_all_permissions_defined PASSED [ 18%]
backend/tests/test_security_phase2.py::TestRBACPermissions::test_admin_has_all_permissions PASSED [ 18%]
backend/tests/test_security_phase2.py::TestRBACPermissions::test_hr_manager_has_correct_permissions PASSED [ 19%]
backend/tests/test_security_phase2.py::TestRBACPermissions::test_employee_has_limited_permissions PASSED [ 19%]
backend/tests/test_security_phase2.py::TestRBACPermissions::test_multiple_roles_union_permissions PASSED [ 19%]
backend/tests/test_security_phase2.py::TestRBACPermissions::test_invalid_role_ignored PASSED [ 20%]
backend/tests/test_security_phase2.py::TestRBACPermissions::test_empty_roles_no_permissions PASSED [ 20%]
backend/tests/test_security_phase2.py::TestRBACManager::test_get_role_permissions PASSED [ 20%]
backend/tests/test_security_phase2.py::TestRBACManager::test_has_permission_method PASSED [ 21%]
backend/tests/test_security_phase2.py::TestRBACManager::test_get_user_roles PASSED [ 21%]
backend/tests/test_security_phase2.py::TestAuditLogging::test_log_employee_create PASSED [ 22%]
backend/tests/test_security_phase2.py::TestAuditLogging::test_log_employee_update PASSED [ 22%]
backend/tests/test_security_phase2.py::TestAuditLogging::test_log_employee_delete PASSED [ 22%]
backend/tests/test_security_phase2.py::TestAuditLogging::test_log_role_change PASSED [ 23%]
backend/tests/test_security_phase2.py::TestAuditLogging::test_audit_entry_has_timestamp PASSED [ 23%]
backend/tests/test_security_phase2.py::TestEncryption::test_encrypt_string PASSED [ 23%]
backend/tests/test_security_phase2.py::TestEncryption::test_decrypt_string PASSED [ 24%]
backend/tests/test_security_phase2.py::TestEncryption::test_encrypt_none_returns_none PASSED [ 24%]
backend/tests/test_security_phase2.py::TestEncryption::test_decrypt_none_returns_none PASSED [ 24%]
backend/tests/test_security_phase2.py::TestEncryption::test_encrypt_different_values_different_results PASSED [ 25%]
backend/tests/test_security_phase2.py::TestEncryption::test_same_value_encrypts_differently_each_time PASSED [ 25%]
backend/tests/test_security_phase2.py::TestEncryption::test_encrypt_integer PASSED [ 25%]
backend/tests/test_security_phase2.py::TestEncryption::test_function_encrypt_decrypt PASSED [ 26%]
backend/tests/test_security_phase2.py::TestEncryption::test_generate_key PASSED [ 26%]
backend/tests/test_security_phase2.py::TestEncryption::test_different_keys_different_encryption PASSED [ 27%]
backend/tests/test_security_phase2.py::TestSecurityIntegration::test_authenticated_user_with_rbac PASSED [ 27%]
backend/tests/test_security_phase2.py::TestSecurityIntegration::test_audit_logs_encrypted_data PASSED [ 27%]
backend/tests/test_security_phase2.py::TestSecurityIntegration::test_permission_denied_flow PASSED [ 28%]
backend/tests/test_performance_phase2.py::TestInMemoryCache::test_set_and_get_value PASSED [ 28%]
backend/tests/test_performance_phase2.py::TestInMemoryCache::test_get_nonexistent_key PASSED [ 28%]
backend/tests/test_performance_phase2.py::TestInMemoryCache::test_delete_key PASSED [ 29%]
backend/tests/test_performance_phase2.py::TestInMemoryCache::test_delete_nonexistent_key PASSED [ 29%]
backend/tests/test_performance_phase2.py::TestInMemoryCache::test_exists_key PASSED [ 29%]
backend/tests/test_performance_phase2.py::TestInMemoryCache::test_cache_expiration PASSED [ 30%]
backend/tests/test_performance_phase2.py::TestInMemoryCache::test_clear_cache PASSED [ 30%]
backend/tests/test_performance_phase2.py::TestInMemoryCache::test_cache_statistics PASSED [ 31%]
backend/tests/test_performance_phase2.py::TestInMemoryCache::test_cache_different_types PASSED [ 31%]
backend/tests/test_performance_phase2.py::TestCacheManager::test_cache_manager_initialization PASSED [ 31%]
backend/tests/test_performance_phase2.py::TestCacheManager::test_cache_manager_get_set PASSED [ 32%]
backend/tests/test_performance_phase2.py::TestCacheManager::test_cache_manager_delete PASSED [ 32%]
backend/tests/test_performance_phase2.py::TestCacheManager::test_cache_manager_exists PASSED [ 32%]
backend/tests/test_performance_phase2.py::TestCacheManager::test_cache_manager_clear PASSED [ 33%]
backend/tests/test_performance_phase2.py::TestCacheManager::test_cache_key_generation PASSED [ 33%]
backend/tests/test_performance_phase2.py::TestCacheManager::test_cache_stats PASSED [ 33%]
backend/tests/test_performance_phase2.py::TestCacheConvenienceFunctions::test_cache_get_function PASSED [ 34%]
backend/tests/test_performance_phase2.py::TestCacheConvenienceFunctions::test_cache_set_function PASSED [ 34%]
backend/tests/test_performance_phase2.py::TestQueryMetrics::test_add_query_basic PASSED [ 35%]
backend/tests/test_performance_phase2.py::TestQueryMetrics::test_slow_query_detection PASSED [ 35%]
backend/tests/test_performance_phase2.py::TestQueryMetrics::test_slow_query_limit PASSED [ 35%]
backend/tests/test_performance_phase2.py::TestQueryMetrics::test_metrics_statistics PASSED [ 36%]
backend/tests/test_performance_phase2.py::TestQueryOptimizer::test_optimizer_initialization PASSED [ 36%]
backend/tests/test_performance_phase2.py::TestQueryOptimizer::test_connection_pool_configuration PASSED [ 36%]
backend/tests/test_performance_phase2.py::TestQueryOptimizer::test_optimize_joins PASSED [ 37%]
backend/tests/test_performance_phase2.py::TestCachedQueryDecorator::test_cached_query_caches_result PASSED [ 37%]
backend/tests/test_performance_phase2.py::TestCachedQueryDecorator::test_cached_query_custom_key_builder PASSED [ 37%]
backend/tests/test_performance_phase2.py::TestBatchQuery::test_batch_query_splits_into_batches PASSED [ 38%]
backend/tests/test_performance_phase2.py::TestTransactionScope::test_transaction_commit PASSED [ 38%]
backend/tests/test_performance_phase2.py::TestTransactionScope::test_transaction_rollback_on_error PASSED [ 38%]
backend/tests/test_performance_phase2.py::TestTransactionScope::test_transaction_always_closes_session PASSED [ 39%]
backend/tests/test_performance_phase2.py::TestIndexRecommendations::test_recommend_indexes_for_common_patterns PASSED [ 39%]
backend/tests/test_performance_phase2.py::TestIndexRecommendations::test_generate_create_index_sql PASSED [ 40%]
backend/tests/test_performance_phase2.py::TestIndexRecommendations::test_composite_index_recommendation PASSED [ 40%]
backend/tests/test_performance_phase2.py::TestPerformanceIntegration::test_cache_hit_ratio_tracking PASSED [ 40%]
backend/tests/test_performance_phase2.py::TestPerformanceIntegration::test_query_performance_monitoring PASSED [ 41%]
backend/tests/test_performance_phase2.py::TestPerformanceIntegration::test_cache_and_query_optimization_together PASSED [ 41%]
backend/tests/test_performance_phase2.py::TestPerformanceBenchmarks::test_cache_get_performance PASSED [ 41%]
backend/tests/test_performance_phase2.py::TestPerformanceBenchmarks::test_cache_set_performance PASSED [ 42%]
backend/tests/test_performance_phase2.py::TestPerformanceBenchmarks::test_large_cache_hit_ratio PASSED [ 42%]
backend/tests/test_monitoring_phase2.py::TestPrometheusMetrics::test_metrics_initialization PASSED [ 42%]
backend/tests/test_monitoring_phase2.py::TestPrometheusMetrics::test_system_metrics_initialized PASSED [ 43%]
backend/tests/test_monitoring_phase2.py::TestPrometheusMetrics::test_api_metrics_initialized PASSED [ 43%]
backend/tests/test_monitoring_phase2.py::TestPrometheusMetrics::test_database_metrics_initialized PASSED [ 44%]
backend/tests/test_monitoring_phase2.py::TestPrometheusMetrics::test_cache_metrics_initialized PASSED [ 44%]
backend/tests/test_monitoring_phase2.py::TestPrometheusMetrics::test_business_metrics_initialized PASSED [ 44%]
backend/tests/test_monitoring_phase2.py::TestPrometheusMetrics::test_record_api_request PASSED [ 45%]
backend/tests/test_monitoring_phase2.py::TestPrometheusMetrics::test_record_api_request_with_error PASSED [ 45%]
backend/tests/test_monitoring_phase2.py::TestPrometheusMetrics::test_record_database_query PASSED [ 45%]
backend/tests/test_monitoring_phase2.py::TestPrometheusMetrics::test_record_slow_query PASSED [ 46%]
backend/tests/test_monitoring_phase2.py::TestPrometheusMetrics::test_record_cache_operation_hit PASSED [ 46%]
backend/tests/test_monitoring_phase2.py::TestPrometheusMetrics::test_record_cache_operation_miss PASSED [ 46%]
backend/tests/test_monitoring_phase2.py::TestPrometheusMetrics::test_update_cache_hit_ratio PASSED [ 47%]
backend/tests/test_monitoring_phase2.py::TestPrometheusMetrics::test_record_business_change PASSED [ 47%]
backend/tests/test_monitoring_phase2.py::TestPrometheusMetrics::test_record_error PASSED [ 48%]
backend/tests/test_monitoring_phase2.py::TestPrometheusMetrics::test_get_metrics_export PASSED [ 48%]
backend/tests/test_monitoring_phase2.py::TestPrometheusMetrics::test_get_content_type PASSED [ 48%]
backend/tests/test_monitoring_phase2.py::TestPrometheusMetrics::test_global_metrics_instance PASSED [ 49%]
backend/tests/test_monitoring_phase2.py::TestPrometheusMetrics::test_initialize_metrics PASSED [ 49%]
backend/tests/test_monitoring_phase2.py::TestMetricsMiddleware::test_middleware_records_request PASSED [ 49%]
backend/tests/test_monitoring_phase2.py::TestMetricsMiddleware::test_middleware_records_error PASSED [ 50%]
backend/tests/test_monitoring_phase2.py::TestMetricsMiddleware::test_database_metrics_recorder PASSED [ 50%]
backend/tests/test_monitoring_phase2.py::TestMetricsMiddleware::test_cache_metrics_recorder PASSED [ 50%]
backend/tests/test_monitoring_phase2.py::TestMetricsMiddleware::test_business_metrics_recorder PASSED [ 51%]
backend/tests/test_monitoring_phase2.py::TestAlertRules::test_alert_rules_structure PASSED [ 51%]
backend/tests/test_monitoring_phase2.py::TestAlertRules::test_alert_groups_defined PASSED [ 51%]
backend/tests/test_monitoring_phase2.py::TestAlertRules::test_system_alerts_defined PASSED [ 52%]
backend/tests/test_monitoring_phase2.py::TestAlertRules::test_api_alerts_defined PASSED [ 52%]
backend/tests/test_monitoring_phase2.py::TestAlertRules::test_database_alerts_defined PASSED [ 53%]
backend/tests/test_monitoring_phase2.py::TestAlertRules::test_cache_alerts_defined PASSED [ 53%]
backend/tests/test_monitoring_phase2.py::TestAlertRules::test_alert_rule_structure PASSED [ 53%]
backend/tests/test_monitoring_phase2.py::TestAlertRules::test_alert_labels_present PASSED [ 54%]
backend/tests/test_monitoring_phase2.py::TestAlertRules::test_get_alert_rules_yaml PASSED [ 54%]
backend/tests/test_monitoring_phase2.py::TestAlertRules::test_validate_alert_rules PASSED [ 54%]
backend/tests/test_monitoring_phase2.py::TestAlertRules::test_alert_expressions_syntax PASSED [ 55%]
backend/tests/test_monitoring_phase2.py::TestGrafanaDashboards::test_dashboard_json_structure PASSED [ 55%]
backend/tests/test_monitoring_phase2.py::TestGrafanaDashboards::test_dashboard_panels_exist PASSED [ 55%]
backend/tests/test_monitoring_phase2.py::TestGrafanaDashboards::test_dashboard_has_prometheus_datasource PASSED [ 56%]
backend/tests/test_monitoring_phase2.py::TestGrafanaDashboards::test_dashboard_refresh_interval PASSED [ 56%]
backend/tests/test_monitoring_phase2.py::TestGrafanaDashboards::test_dashboard_time_range PASSED [ 57%]
backend/tests/test_monitoring_phase2.py::TestMetricsIntegration::test_metrics_end_to_end PASSED [ 57%]
backend/tests/test_monitoring_phase2.py::TestMetricsIntegration::test_multiple_operations_tracked PASSED [ 57%]
backend/tests/test_monitoring_phase2.py::TestMetricsIntegration::test_error_tracking PASSED [ 58%]
backend/tests/test_monitoring_phase2.py::TestMetricsIntegration::test_metric_labels_recorded PASSED [ 58%]
backend/tests/test_monitoring_phase2.py::TestMetricsPerformance::test_metrics_recording_speed PASSED [ 58%]
backend/tests/test_monitoring_phase2.py::TestMetricsPerformance::test_concurrent_metrics_recording PASSED [ 59%]
backend/tests/test_monitoring_phase2.py::TestMetricsNamespaces::test_namespace_enum_values PASSED [ 59%]
backend/tests/test_monitoring_phase2.py::TestMetricsNamespaces::test_metric_names_use_namespace PASSED [ 59%]
backend/tests/test_protection_phase2.py::TestRateLimitConfig::test_config_initialization PASSED [ 60%]
backend/tests/test_protection_phase2.py::TestRateLimitConfig::test_config_with_custom_strategy PASSED [ 60%]
backend/tests/test_protection_phase2.py::TestRateLimitConfig::test_config_hour_limit_calculation PASSED [ 61%]
backend/tests/test_protection_phase2.py::TestSlidingWindowLimiter::test_sliding_window_allow_request PASSED [ 61%]
backend/tests/test_protection_phase2.py::TestSlidingWindowLimiter::test_sliding_window_exceed_limit PASSED [ 61%]
backend/tests/test_protection_phase2.py::TestSlidingWindowLimiter::test_sliding_window_different_clients PASSED [ 62%]
backend/tests/test_protection_phase2.py::TestTokenBucketLimiter::test_token_bucket_initialization PASSED [ 62%]
backend/tests/test_protection_phase2.py::TestTokenBucketLimiter::test_token_bucket_allow_request PASSED [ 62%]
backend/tests/test_protection_phase2.py::TestTokenBucketLimiter::test_token_bucket_burst_allowed PASSED [ 63%]
backend/tests/test_protection_phase2.py::TestRateLimiter::test_rate_limiter_add_endpoint PASSED [ 63%]
backend/tests/test_protection_phase2.py::TestRateLimiter::test_rate_limiter_check_endpoint PASSED [ 63%]
backend/tests/test_protection_phase2.py::TestRateLimiter::test_rate_limiter_unconfigured_endpoint PASSED [ 64%]
backend/tests/test_protection_phase2.py::TestRateLimiter::test_rate_limiter_reset_client PASSED [ 64%]
backend/tests/test_protection_phase2.py::TestRequestValidationConfig::test_default_config PASSED [ 64%]
backend/tests/test_protection_phase2.py::TestRequestValidationConfig::test_custom_config PASSED [ 65%]
backend/tests/test_protection_phase2.py::TestPayloadValidator::test_validate_required_fields_success PASSED [ 65%]
backend/tests/test_protection_phase2.py::TestPayloadValidator::test_validate_required_fields_missing PASSED [ 66%]
backend/tests/test_protection_phase2.py::TestPayloadValidator::test_validate_field_types_success PASSED [ 66%]
backend/tests/test_protection_phase2.py::TestPayloadValidator::test_validate_field_types_failure PASSED [ 66%]
backend/tests/test_protection_phase2.py::TestPayloadValidator::test_validate_field_values_success PASSED [ 67%]
backend/tests/test_protection_phase2.py::TestPayloadValidator::test_validate_field_values_failure PASSED [ 67%]
backend/tests/test_protection_phase2.py::TestInputSanitizer::test_sanitize_string_removes_nulls PASSED [ 67%]
backend/tests/test_protection_phase2.py::TestInputSanitizer::test_sanitize_string_trims_whitespace PASSED [ 68%]
backend/tests/test_protection_phase2.py::TestInputSanitizer::test_sanitize_string_max_length PASSED [ 68%]
backend/tests/test_protection_phase2.py::TestInputSanitizer::test_sanitize_dict PASSED [ 68%]
backend/tests/test_protection_phase2.py::TestInputSanitizer::test_detect_sql_injection PASSED [ 69%]
backend/tests/test_protection_phase2.py::TestInputSanitizer::test_detect_script_injection PASSED [ 69%]
backend/tests/test_protection_phase2.py::TestDDoSProtector::test_ddos_config_initialization PASSED [ 70%]
backend/tests/test_protection_phase2.py::TestDDoSProtector::test_ip_stats_creation PASSED [ 70%]
backend/tests/test_protection_phase2.py::TestDDoSProtector::test_ddos_check_ip_safe PASSED [ 70%]
backend/tests/test_protection_phase2.py::TestDDoSProtector::test_ddos_record_request PASSED [ 71%]
backend/tests/test_protection_phase2.py::TestDDoSProtector::test_ddos_record_error PASSED [ 71%]
backend/tests/test_protection_phase2.py::TestDDoSProtector::test_ddos_block_ip PASSED [ 71%]
backend/tests/test_protection_phase2.py::TestDDoSProtector::test_ddos_permanent_blacklist PASSED [ 72%]
backend/tests/test_protection_phase2.py::TestDDoSProtector::test_ddos_whitelist_ip PASSED [ 72%]
backend/tests/test_protection_phase2.py::TestDDoSProtector::test_ddos_threat_summary PASSED [ 72%]
backend/tests/test_protection_phase2.py::TestDDoSProtector::test_ddos_error_rate_escalation PASSED [ 73%]
backend/tests/test_protection_phase2.py::TestRateLimiterIntegration::test_multiple_endpoints PASSED [ 73%]
backend/tests/test_protection_phase2.py::TestRateLimiterIntegration::test_rate_limiter_concurrent_access PASSED [ 74%]
backend/tests/test_protection_phase2.py::TestDDoSIntegration::test_ddos_escalation_chain PASSED [ 74%]
backend/tests/test_security_scanning_phase2.py::TestSecurityScanner::test_scanner_initialization PASSED [ 74%]
backend/tests/test_security_scanning_phase2.py::TestSecurityScanner::test_scanner_reset PASSED [ 75%]
backend/tests/test_security_scanning_phase2.py::TestSecurityScanner::test_hardcoded_secrets_detection PASSED [ 75%]
backend/tests/test_security_scanning_phase2.py::TestSecurityScanner::test_sql_injection_detection PASSED [ 75%]
backend/tests/test_security_scanning_phase2.py::TestSecurityScanner::test_command_injection_detection PASSED [ 76%]
backend/tests/test_security_scanning_phase2.py::TestSecurityScanner::test_insecure_deserialization_detection PASSED [ 76%]
backend/tests/test_security_scanning_phase2.py::TestSecurityScanner::test_weak_cryptography_detection PASSED [ 76%]
backend/tests/test_security_scanning_phase2.py::TestSecurityScanner::test_hardcoded_credentials_detection PASSED [ 77%]
backend/tests/test_security_scanning_phase2.py::TestSecurityScanner::test_xxe_vulnerability_detection PASSED [ 77%]
backend/tests/test_security_scanning_phase2.py::TestSecurityScanner::test_ssrf_vulnerability_detection PASSED [ 77%]
backend/tests/test_security_scanning_phase2.py::TestSecurityScanner::test_insecure_logging_detection PASSED [ 78%]
backend/tests/test_security_scanning_phase2.py::TestSecurityScanner::test_vulnerability_to_dict PASSED [ 78%]
backend/tests/test_security_scanning_phase2.py::TestSecurityScanner::test_get_summary PASSED [ 79%]
backend/tests/test_security_scanning_phase2.py::TestSecurityScanner::test_scan_python_code PASSED [ 79%]
backend/tests/test_security_scanning_phase2.py::TestSecurityScanner::test_singleton_instance PASSED [ 79%]
backend/tests/test_security_scanning_phase2.py::TestBanditAnalyzer::test_analyzer_initialization PASSED [ 80%]
backend/tests/test_security_scanning_phase2.py::TestBanditAnalyzer::test_bandit_issue_creation PASSED [ 80%]
backend/tests/test_security_scanning_phase2.py::TestBanditAnalyzer::test_bandit_issue_to_dict PASSED [ 80%]
backend/tests/test_security_scanning_phase2.py::TestBanditAnalyzer::test_bandit_summary_generation PASSED [ 81%]
backend/tests/test_security_scanning_phase2.py::TestBanditAnalyzer::test_singleton_instance PASSED [ 81%]
backend/tests/test_security_scanning_phase2.py::TestSemgrepAnalyzer::test_analyzer_initialization PASSED [ 81%]
backend/tests/test_security_scanning_phase2.py::TestSemgrepAnalyzer::test_semgrep_match_creation PASSED [ 82%]
backend/tests/test_security_scanning_phase2.py::TestSemgrepAnalyzer::test_semgrep_match_to_dict PASSED [ 82%]
backend/tests/test_security_scanning_phase2.py::TestSemgrepAnalyzer::test_semgrep_summary_generation PASSED [ 83%]
backend/tests/test_security_scanning_phase2.py::TestSemgrepAnalyzer::test_singleton_instance PASSED [ 83%]
backend/tests/test_security_scanning_phase2.py::TestSemgrepAnalyzer::test_different_instances_for_different_paths PASSED [ 83%]
backend/tests/test_security_scanning_phase2.py::TestSecurityReport::test_report_initialization PASSED [ 84%]
backend/tests/test_security_scanning_phase2.py::TestSecurityReport::test_metrics_creation PASSED [ 84%]
backend/tests/test_security_scanning_phase2.py::TestSecurityReport::test_metrics_as_dict PASSED [ 84%]
backend/tests/test_security_scanning_phase2.py::TestSecurityReport::test_summary_generation PASSED [ 85%]
backend/tests/test_security_scanning_phase2.py::TestSecurityReport::test_singleton_instance PASSED [ 85%]
backend/tests/test_security_scanning_phase2.py::TestSecurityReport::test_json_export_format PASSED [ 85%]
backend/tests/test_security_scanning_phase2.py::TestSecurityReport::test_markdown_export_format PASSED [ 86%]
backend/tests/test_security_scanning_phase2.py::TestSecurityReport::test_html_export_format PASSED [ 86%]
backend/tests/test_security_scanning_phase2.py::TestIntegration::test_scanner_with_vulnerable_code PASSED [ 87%]
backend/tests/test_security_scanning_phase2.py::TestIntegration::test_multiple_vulnerability_types PASSED [ 87%]
backend/tests/test_security_scanning_phase2.py::TestIntegration::test_severity_levels PASSED [ 87%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeCreation::test_create_employee_basic ERROR [ 88%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeCreation::test_create_employee_basic ERROR [ 88%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeCreation::test_create_employee_with_optional_fields ERROR [ 88%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeCreation::test_create_employee_with_optional_fields ERROR [ 88%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeCreation::test_create_multiple_employees_same_org ERROR [ 88%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeCreation::test_create_multiple_employees_same_org ERROR [ 88%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeCreation::test_employee_default_status ERROR [ 89%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeCreation::test_employee_default_status ERROR [ 89%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeCreation::test_create_employee_unicode_name ERROR [ 89%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeCreation::test_create_employee_unicode_name ERROR [ 89%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeCreation::test_create_employee_email_case_sensitivity ERROR [ 89%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeCreation::test_create_employee_email_case_sensitivity ERROR [ 89%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeRetrieval::test_retrieve_employee_by_id ERROR [ 90%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeRetrieval::test_retrieve_employee_by_id ERROR [ 90%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeRetrieval::test_retrieve_employee_not_found PASSED [ 90%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeRetrieval::test_retrieve_employee_not_found ERROR [ 90%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeRetrieval::test_retrieve_employees_by_department ERROR [ 90%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeRetrieval::test_retrieve_employees_by_department ERROR [ 90%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeRetrieval::test_retrieve_employees_by_organization ERROR [ 91%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeRetrieval::test_retrieve_employees_by_organization ERROR [ 91%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeRetrieval::test_retrieve_employees_paginated ERROR [ 91%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeRetrieval::test_retrieve_employees_paginated ERROR [ 91%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeRetrieval::test_retrieve_employee_with_relationships ERROR [ 92%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeRetrieval::test_retrieve_employee_with_relationships ERROR [ 92%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeUpdate::test_update_employee_name ERROR [ 92%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeUpdate::test_update_employee_name ERROR [ 92%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeUpdate::test_update_employee_email ERROR [ 92%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeUpdate::test_update_employee_email ERROR [ 92%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeUpdate::test_update_employee_department ERROR [ 93%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeUpdate::test_update_employee_department ERROR [ 93%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeUpdate::test_update_employee_multiple_fields ERROR [ 93%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeUpdate::test_update_employee_multiple_fields ERROR [ 93%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeUpdate::test_update_preserves_other_fields ERROR [ 93%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeUpdate::test_update_preserves_other_fields ERROR [ 93%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeDelete::test_delete_employee ERROR [ 94%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeDelete::test_delete_employee ERROR [ 94%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeDelete::test_delete_employee_cascade_check ERROR [ 94%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeDelete::test_delete_employee_cascade_check ERROR [ 94%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeDelete::test_delete_nonexistent_employee PASSED [ 94%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeDelete::test_delete_nonexistent_employee ERROR [ 94%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeErrorHandling::test_duplicate_employee_id_error ERROR [ 95%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeErrorHandling::test_duplicate_employee_id_error ERROR [ 95%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeErrorHandling::test_missing_required_organization_id ERROR [ 95%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeErrorHandling::test_missing_required_organization_id ERROR [ 95%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeErrorHandling::test_invalid_department_reference ERROR [ 96%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeErrorHandling::test_invalid_department_reference ERROR [ 96%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeErrorHandling::test_invalid_designation_reference ERROR [ 96%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeErrorHandling::test_invalid_designation_reference ERROR [ 96%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeErrorHandling::test_invalid_email_format ERROR [ 96%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeErrorHandling::test_invalid_email_format ERROR [ 96%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeErrorHandling::test_future_date_of_birth ERROR [ 97%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeErrorHandling::test_future_date_of_birth ERROR [ 97%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeErrorHandling::test_joining_date_before_birth_date ERROR [ 97%]
backend/tests/test_employee_crud_expanded.py::TestEmployeeErrorHandling::test_joining_date_before_birth_date ERROR [ 97%]
backend/tests/test_employee_crud_expanded.py::TestTransactionBehavior::test_rollback_on_error ERROR [ 97%]
backend/tests/test_employee_crud_expanded.py::TestTransactionBehavior::test_rollback_on_error ERROR [ 97%]
backend/tests/test_employee_crud_expanded.py::TestTransactionBehavior::test_partial_commit_isolation ERROR [ 98%]
backend/tests/test_employee_crud_expanded.py::TestTransactionBehavior::test_partial_commit_isolation ERROR [ 98%]
backend/tests/test_employee_crud_expanded.py::TestTransactionBehavior::test_nested_updates_in_transaction ERROR [ 98%]
backend/tests/test_employee_crud_expanded.py::TestTransactionBehavior::test_nested_updates_in_transaction ERROR [ 98%]
backend/tests/test_employee_crud_expanded.py::TestAggregateOperations::test_count_employees_by_department ERROR [ 98%]
backend/tests/test_employee_crud_expanded.py::TestAggregateOperations::test_count_employees_by_department ERROR [ 98%]
backend/tests/test_employee_crud_expanded.py::TestAggregateOperations::test_count_employees_by_organization ERROR [ 99%]
backend/tests/test_employee_crud_expanded.py::TestAggregateOperations::test_count_employees_by_organization ERROR [ 99%]
backend/tests/test_employee_crud_expanded.py::TestAggregateOperations::test_bulk_status_update ERROR [ 99%]
backend/tests/test_employee_crud_expanded.py::TestAggregateOperations::test_bulk_status_update ERROR [ 99%]
backend/tests/test_employee_crud_expanded.py::TestAggregateOperations::test_distinct_departments_in_org ERROR [100%]
backend/tests/test_employee_crud_expanded.py::TestAggregateOperations::test_distinct_departments_in_org ERROR [100%]

=================================== ERRORS ====================================
__ ERROR at teardown of TestDepartmentCreation.test_create_department_basic ___

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestDepartmentCreation.test_create_department_with_description _

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFE950500>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE950BF0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFE6A8940>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE950BF0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFE66F4D0>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_DEPT_TEST",
            code="DEPT_ORG",
            name="Department Test Org",
            email="dept@test.com",
            phone="555-0000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_department_crud.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFE6A8940>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE950BF0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, None, None, None, 'dept@test.com', '555-0000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestDepartmentCreation.test_create_department_with_description _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_____ ERROR at setup of TestDepartmentCreation.test_create_subdepartment ______

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFE9B8D70>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9B8290>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF743340>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9B8290>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFE9B98E0>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_DEPT_TEST",
            code="DEPT_ORG",
            name="Department Test Org",
            email="dept@test.com",
            phone="555-0000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_department_crud.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF743340>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9B8290>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, None, None, None, 'dept@test.com', '555-0000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
____ ERROR at teardown of TestDepartmentCreation.test_create_subdepartment ____

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestDepartmentCreation.test_create_nested_subdepartments __

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFE9BA8D0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9BAB40>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEA96040>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9BAB40>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFE9BA570>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_DEPT_TEST",
            code="DEPT_ORG",
            name="Department Test Org",
            email="dept@test.com",
            phone="555-0000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_department_crud.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEA96040>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9BAB40>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, None, None, None, 'dept@test.com', '555-0000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestDepartmentCreation.test_create_nested_subdepartments _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestDepartmentCreation.test_create_multiple_departments_same_org _

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFEB85340>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB856A0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFED4BBC0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB856A0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFEB86480>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_DEPT_TEST",
            code="DEPT_ORG",
            name="Department Test Org",
            email="dept@test.com",
            phone="555-0000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_department_crud.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFED4BBC0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB856A0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, None, None, None, 'dept@test.com', '555-0000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestDepartmentCreation.test_create_multiple_departments_same_org _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestDepartmentCreation.test_department_unique_per_organization _

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFEB866F0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB852E0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEFF02C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB852E0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFEB84500>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_DEPT_TEST",
            code="DEPT_ORG",
            name="Department Test Org",
            email="dept@test.com",
            phone="555-0000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_department_crud.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEFF02C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB852E0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, None, None, None, 'dept@test.com', '555-0000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestDepartmentCreation.test_department_unique_per_organization _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
__ ERROR at setup of TestDepartmentRetrieval.test_retrieve_department_by_id ___

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFE9FE900>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9FD010>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF743D40>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9FD010>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFE9FC380>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_DEPT_TEST",
            code="DEPT_ORG",
            name="Department Test Org",
            email="dept@test.com",
            phone="555-0000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_department_crud.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF743D40>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9FD010>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, None, None, None, 'dept@test.com', '555-0000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestDepartmentRetrieval.test_retrieve_department_by_id _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestDepartmentRetrieval.test_retrieve_all_departments_in_org _

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFE9FF050>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9FEB10>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFE8EE4C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9FEB10>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFE9FE5D0>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_DEPT_TEST",
            code="DEPT_ORG",
            name="Department Test Org",
            email="dept@test.com",
            phone="555-0000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_department_crud.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFE8EE4C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9FEB10>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, None, None, None, 'dept@test.com', '555-0000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestDepartmentRetrieval.test_retrieve_all_departments_in_org _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at teardown of TestDepartmentRetrieval.test_retrieve_department_not_found _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
___ ERROR at setup of TestDepartmentRetrieval.test_retrieve_subdepartments ____

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFEA1D8E0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEA1E7E0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFFB094C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEA1E7E0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFEA1D8B0>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_DEPT_TEST",
            code="DEPT_ORG",
            name="Department Test Org",
            email="dept@test.com",
            phone="555-0000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_department_crud.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFFB094C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEA1E7E0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, None, None, None, 'dept@test.com', '555-0000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
__ ERROR at teardown of TestDepartmentRetrieval.test_retrieve_subdepartments __

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestDepartmentRetrieval.test_retrieve_department_with_employees _

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFEB84B60>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB84E60>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF140BC0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB84E60>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFEB848F0>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_DEPT_TEST",
            code="DEPT_ORG",
            name="Department Test Org",
            email="dept@test.com",
            phone="555-0000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_department_crud.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF140BC0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB84E60>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, None, None, None, 'dept@test.com', '555-0000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestDepartmentRetrieval.test_retrieve_department_with_employees _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_____ ERROR at setup of TestDepartmentUpdate.test_update_department_name ______

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFE5CCD40>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE5CDBB0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF7432C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE5CDBB0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFE951370>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_DEPT_TEST",
            code="DEPT_ORG",
            name="Department Test Org",
            email="dept@test.com",
            phone="555-0000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_department_crud.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF7432C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE5CDBB0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, None, None, None, 'dept@test.com', '555-0000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
____ ERROR at teardown of TestDepartmentUpdate.test_update_department_name ____

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_____ ERROR at setup of TestDepartmentUpdate.test_update_department_code ______

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFE5BF440>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE5BEC60>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF2E53C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE5BEC60>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFE5BFDA0>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_DEPT_TEST",
            code="DEPT_ORG",
            name="Department Test Org",
            email="dept@test.com",
            phone="555-0000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_department_crud.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF2E53C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE5BEC60>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, None, None, None, 'dept@test.com', '555-0000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
____ ERROR at teardown of TestDepartmentUpdate.test_update_department_code ____

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
__ ERROR at setup of TestDepartmentUpdate.test_update_department_description __

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFE4B0980>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFC5FC6E0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF02D640>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFC5FC6E0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFCEEFAD0>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_DEPT_TEST",
            code="DEPT_ORG",
            name="Department Test Org",
            email="dept@test.com",
            phone="555-0000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_department_crud.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF02D640>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFC5FC6E0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, None, None, None, 'dept@test.com', '555-0000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestDepartmentUpdate.test_update_department_description _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_____ ERROR at setup of TestDepartmentDelete.test_delete_empty_department _____

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFC5D90D0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFC5D9280>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF141EC0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFC5D9280>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFC5FC1D0>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_DEPT_TEST",
            code="DEPT_ORG",
            name="Department Test Org",
            email="dept@test.com",
            phone="555-0000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_department_crud.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF141EC0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFC5D9280>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, None, None, None, 'dept@test.com', '555-0000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
___ ERROR at teardown of TestDepartmentDelete.test_delete_empty_department ____

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestDepartmentDelete.test_delete_department_cascade_check _

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFE9FC350>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9FE5A0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEFF2EC0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9FE5A0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFE9FFBC0>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_DEPT_TEST",
            code="DEPT_ORG",
            name="Department Test Org",
            email="dept@test.com",
            phone="555-0000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_department_crud.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEFF2EC0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9FE5A0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, None, None, None, 'dept@test.com', '555-0000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestDepartmentDelete.test_delete_department_cascade_check _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at teardown of TestDepartmentErrorHandling.test_missing_required_organization _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at teardown of TestDepartmentErrorHandling.test_invalid_parent_subdepartment _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestDepartmentErrorHandling.test_department_unicode_name __

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFE9E9430>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9E8170>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF148C40>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9E8170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFE9E91F0>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_DEPT_TEST",
            code="DEPT_ORG",
            name="Department Test Org",
            email="dept@test.com",
            phone="555-0000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_department_crud.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF148C40>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9E8170>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, None, None, None, 'dept@test.com', '555-0000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestDepartmentErrorHandling.test_department_unicode_name _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestDepartmentErrorHandling.test_circular_subdepartment_reference _

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFE9E9760>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9E9970>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF02C4C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9E9970>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFE9EB650>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_DEPT_TEST",
            code="DEPT_ORG",
            name="Department Test Org",
            email="dept@test.com",
            phone="555-0000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_department_crud.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF02C4C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9E9970>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_DEPT_TEST', 'DEPT_ORG', 'Department Test Org', 1, '["hcm"]', None, None, None, None, 'dept@test.com', '555-0000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestDepartmentErrorHandling.test_circular_subdepartment_reference _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
____ ERROR at teardown of TestJobLevelCreation.test_create_job_level_basic ____

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
___ ERROR at setup of TestJobLevelCreation.test_create_job_level_hierarchy ____

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFE9F1A30>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9F1F10>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFFA6E640>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9F1F10>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFE9F1F40>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_JOB_TEST",
            code="JOB_ORG",
            name="Job Test Organization",
            email="job@test.com",
            phone="555-1000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_job_levels_grades.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFFA6E640>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9F1F10>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, None, None, None, 'job@test.com', '555-1000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
__ ERROR at teardown of TestJobLevelCreation.test_create_job_level_hierarchy __

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
__ ERROR at setup of TestJobLevelCreation.test_retrieve_job_level_by_number ___

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFE9F3110>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9F3A40>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFE4A6A40>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9F3A40>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFE9F32F0>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_JOB_TEST",
            code="JOB_ORG",
            name="Job Test Organization",
            email="job@test.com",
            phone="555-1000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_job_levels_grades.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFE4A6A40>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9F3A40>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, None, None, None, 'job@test.com', '555-1000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestJobLevelCreation.test_retrieve_job_level_by_number _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_____ ERROR at setup of TestJobLevelCreation.test_job_level_numeric_order _____

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFEB19580>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB19AC0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF143A40>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB19AC0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFEB18B90>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_JOB_TEST",
            code="JOB_ORG",
            name="Job Test Organization",
            email="job@test.com",
            phone="555-1000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_job_levels_grades.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF143A40>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB19AC0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, None, None, None, 'job@test.com', '555-1000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
___ ERROR at teardown of TestJobLevelCreation.test_job_level_numeric_order ____

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_________ ERROR at setup of TestGradeCreation.test_create_grade_basic _________

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFEB2DC40>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB2D970>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEA8B740>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB2D970>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFEB1BF50>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_JOB_TEST",
            code="JOB_ORG",
            name="Job Test Organization",
            email="job@test.com",
            phone="555-1000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_job_levels_grades.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEA8B740>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB2D970>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, None, None, None, 'job@test.com', '555-1000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_______ ERROR at teardown of TestGradeCreation.test_create_grade_basic ________

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_______ ERROR at setup of TestGradeCreation.test_create_multiple_grades _______

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFEB2D490>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB2DE50>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF2769C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB2DE50>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFEB2D0D0>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_JOB_TEST",
            code="JOB_ORG",
            name="Job Test Organization",
            email="job@test.com",
            phone="555-1000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_job_levels_grades.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF2769C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB2DE50>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, None, None, None, 'job@test.com', '555-1000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_____ ERROR at teardown of TestGradeCreation.test_create_multiple_grades ______

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
______ ERROR at setup of TestGradeCreation.test_retrieve_grade_by_level _______

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFEB2F680>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB2FF80>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFE8EEDC0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB2FF80>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFEB2C530>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_JOB_TEST",
            code="JOB_ORG",
            name="Job Test Organization",
            email="job@test.com",
            phone="555-1000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_job_levels_grades.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFE8EEDC0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB2FF80>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, None, None, None, 'job@test.com', '555-1000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_____ ERROR at teardown of TestGradeCreation.test_retrieve_grade_by_level _____

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
____ ERROR at setup of TestGradeCreation.test_grade_organization_isolation ____

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFEB19AC0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB19D00>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEA97CC0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB19D00>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFEB1B830>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_JOB_TEST",
            code="JOB_ORG",
            name="Job Test Organization",
            email="job@test.com",
            phone="555-1000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_job_levels_grades.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEA97CC0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB19D00>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, None, None, None, 'job@test.com', '555-1000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
__ ERROR at teardown of TestGradeCreation.test_grade_organization_isolation ___

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
___ ERROR at setup of TestDesignationCreation.test_create_designation_basic ___

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFE9F2600>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9F27B0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFE4A60C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9F27B0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFE9F1C70>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_JOB_TEST",
            code="JOB_ORG",
            name="Job Test Organization",
            email="job@test.com",
            phone="555-1000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_job_levels_grades.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFE4A60C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9F27B0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, None, None, None, 'job@test.com', '555-1000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestDesignationCreation.test_create_designation_basic __

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestDesignationCreation.test_create_designation_with_levels _

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFE4B12E0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFC5FD9A0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFE5C1AC0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFC5FD9A0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFE4B0BC0>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_JOB_TEST",
            code="JOB_ORG",
            name="Job Test Organization",
            email="job@test.com",
            phone="555-1000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_job_levels_grades.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFE5C1AC0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFC5FD9A0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, None, None, None, 'job@test.com', '555-1000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestDesignationCreation.test_create_designation_with_levels _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestDesignationCreation.test_retrieve_designation_by_department _

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFE5CCBF0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE5CD190>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFFA6F240>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE5CD190>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFC5FD250>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_JOB_TEST",
            code="JOB_ORG",
            name="Job Test Organization",
            email="job@test.com",
            phone="555-1000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_job_levels_grades.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFFA6F240>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE5CD190>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, None, None, None, 'job@test.com', '555-1000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestDesignationCreation.test_retrieve_designation_by_department _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestDesignationCreation.test_designation_grade_relationship _

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFE9FC170>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9FF770>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFFB0A440>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9FF770>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFE9FC680>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_JOB_TEST",
            code="JOB_ORG",
            name="Job Test Organization",
            email="job@test.com",
            phone="555-1000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_job_levels_grades.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFFB0A440>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFE9FF770>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, None, None, None, 'job@test.com', '555-1000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestDesignationCreation.test_designation_grade_relationship _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestJobDesignationRelationships.test_designation_requires_grade _

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFEB5BB60>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB5AE40>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF1419C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB5AE40>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFC8F0170>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_JOB_TEST",
            code="JOB_ORG",
            name="Job Test Organization",
            email="job@test.com",
            phone="555-1000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_job_levels_grades.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF1419C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB5AE40>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, None, None, None, 'job@test.com', '555-1000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestJobDesignationRelationships.test_designation_requires_grade _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestJobDesignationRelationships.test_designation_requires_department _

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFEB58B60>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB5A0F0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFFA6D440>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB5A0F0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFEB5BEF0>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_JOB_TEST",
            code="JOB_ORG",
            name="Job Test Organization",
            email="job@test.com",
            phone="555-1000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_job_levels_grades.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFFA6D440>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB5A0F0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, None, None, None, 'job@test.com', '555-1000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestJobDesignationRelationships.test_designation_requires_department _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestJobDesignationRelationships.test_employee_with_designation _

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFEB5FD40>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB5C7A0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFFC3C0C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB5C7A0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFEB5D6D0>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_JOB_TEST",
            code="JOB_ORG",
            name="Job Test Organization",
            email="job@test.com",
            phone="555-1000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_job_levels_grades.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFFC3C0C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB5C7A0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, None, None, None, 'job@test.com', '555-1000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestJobDesignationRelationships.test_employee_with_designation _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestJobDesignationRelationships.test_job_level_grade_mapping _

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFEB5E600>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB5ED20>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF276CC0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB5ED20>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFEB5E210>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_JOB_TEST",
            code="JOB_ORG",
            name="Job Test Organization",
            email="job@test.com",
            phone="555-1000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_job_levels_grades.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF276CC0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB5ED20>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, None, None, None, 'job@test.com', '555-1000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestJobDesignationRelationships.test_job_level_grade_mapping _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestJobDesignationErrorHandling.test_duplicate_designation_code _

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFEB0BEC0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB08F50>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF5EE2C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB08F50>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFEB09940>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_JOB_TEST",
            code="JOB_ORG",
            name="Job Test Organization",
            email="job@test.com",
            phone="555-1000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_job_levels_grades.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF5EE2C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB08F50>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, None, None, None, 'job@test.com', '555-1000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestJobDesignationErrorHandling.test_duplicate_designation_code _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestJobDesignationErrorHandling.test_negative_grade_level _

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFEB0B230>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB0B8F0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFE5A2840>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB0B8F0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFEB0AF60>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_JOB_TEST",
            code="JOB_ORG",
            name="Job Test Organization",
            email="job@test.com",
            phone="555-1000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_job_levels_grades.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFE5A2840>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB0B8F0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, None, None, None, 'job@test.com', '555-1000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestJobDesignationErrorHandling.test_negative_grade_level _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestJobDesignationErrorHandling.test_zero_job_level_number _

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFF7D8290>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFF7D90D0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF140A40>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFF7D90D0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFF7DA0C0>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_JOB_TEST",
            code="JOB_ORG",
            name="Job Test Organization",
            email="job@test.com",
            phone="555-1000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_job_levels_grades.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF140A40>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFF7D90D0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, None, None, None, 'job@test.com', '555-1000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestJobDesignationErrorHandling.test_zero_job_level_number _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestJobDesignationErrorHandling.test_very_long_designation_name _

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFF7DAB10>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFF7DB290>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF0270C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFF7DB290>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFF7DA840>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_JOB_TEST",
            code="JOB_ORG",
            name="Job Test Organization",
            email="job@test.com",
            phone="555-1000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_job_levels_grades.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF0270C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFF7DB290>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, None, None, None, 'job@test.com', '555-1000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestJobDesignationErrorHandling.test_very_long_designation_name _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestJobDesignationErrorHandling.test_special_characters_in_code _

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFF7F1070>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFF7F1760>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFC6B3EC0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFF7F1760>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFF7F0530>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_JOB_TEST",
            code="JOB_ORG",
            name="Job Test Organization",
            email="job@test.com",
            phone="555-1000"
        )
        db.add(org)
>       db.commit()

backend\tests\test_job_levels_grades.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFC6B3EC0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFF7F1760>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_JOB_TEST', 'JOB_ORG', 'Job Test Organization', 1, '["hcm"]', None, None, None, None, 'job@test.com', '555-1000', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, None, None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestJobDesignationErrorHandling.test_special_characters_in_code _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
______ ERROR at setup of TestEmployeeCreation.test_create_employee_basic ______

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFEC20EF0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC21280>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE9287A0>
parameters = [('DEPT_TEST', 'DEPT_CODE', 'Engineering', 1, 'ORG_TEST', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEB74840>
statement = 'INSERT INTO core_departments (id, code, name, "isActive", organization_id, hod_id, manager_id, description, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('DEPT_TEST', 'DEPT_CODE', 'Engineering', 1, 'ORG_TEST', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC21280>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_departments.name

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFEC20980>
test_org = <backend.domains.core.models.DBOrganization object at 0x000002BDFEC20AD0>

    @pytest.fixture
    def test_dept(db, test_org):
        """Create test department"""
        dept = DBDepartment(
            id="DEPT_TEST",
            code="DEPT_CODE",
            name="Engineering",
            organization_id=test_org.id,
            description="Engineering department"
        )
        db.add(dept)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:77: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEB74840>
statement = 'INSERT INTO core_departments (id, code, name, "isActive", organization_id, hod_id, manager_id, description, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('DEPT_TEST', 'DEPT_CODE', 'Engineering', 1, 'ORG_TEST', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC21280>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_departments.name
E       [SQL: INSERT INTO core_departments (id, code, name, "isActive", organization_id, hod_id, manager_id, description, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('DEPT_TEST', 'DEPT_CODE', 'Engineering', 1, 'ORG_TEST', None, None, 'Engineering department', None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
____ ERROR at teardown of TestEmployeeCreation.test_create_employee_basic _____

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestEmployeeCreation.test_create_employee_with_optional_fields _

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFEC23A40>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC23CB0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF3EB4C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC23CB0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFEC23740>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF3EB4C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC23CB0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestEmployeeCreation.test_create_employee_with_optional_fields _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestEmployeeCreation.test_create_multiple_employees_same_org _

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFEBAD7F0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEBADFA0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEB8EB40>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEBADFA0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFEBAD430>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEB8EB40>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEBADFA0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestEmployeeCreation.test_create_multiple_employees_same_org _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_____ ERROR at setup of TestEmployeeCreation.test_employee_default_status _____

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFEBAEB10>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEBAF290>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BD80227A40>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEBAF290>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFEBAF470>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BD80227A40>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEBAF290>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
___ ERROR at teardown of TestEmployeeCreation.test_employee_default_status ____

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
__ ERROR at setup of TestEmployeeCreation.test_create_employee_unicode_name ___

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFEB91520>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB91760>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFFF3D340>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB91760>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFEB90A10>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFFF3D340>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEB91760>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestEmployeeCreation.test_create_employee_unicode_name _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestEmployeeCreation.test_create_employee_email_case_sensitivity _

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFEC34080>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC34320>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEB8D240>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC34320>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFEB93D10>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEB8D240>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC34320>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestEmployeeCreation.test_create_employee_email_case_sensitivity _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
____ ERROR at setup of TestEmployeeRetrieval.test_retrieve_employee_by_id _____

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFEC36330>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC36570>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BD802263C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC36570>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFEC35FA0>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BD802263C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC36570>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
___ ERROR at teardown of TestEmployeeRetrieval.test_retrieve_employee_by_id ___

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at teardown of TestEmployeeRetrieval.test_retrieve_employee_not_found _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestEmployeeRetrieval.test_retrieve_employees_by_department _

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFEC1F8F0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC1FC50>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEB8CD40>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC1FC50>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFEC1F6B0>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEB8CD40>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC1FC50>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestEmployeeRetrieval.test_retrieve_employees_by_department _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestEmployeeRetrieval.test_retrieve_employees_by_organization _

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFEBAEAB0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEBAFC20>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFFF3F240>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEBAFC20>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFEBAF440>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFFF3F240>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEBAFC20>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestEmployeeRetrieval.test_retrieve_employees_by_organization _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
__ ERROR at setup of TestEmployeeRetrieval.test_retrieve_employees_paginated __

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFEC1FA10>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC1EF60>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BD802240C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC1EF60>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFE57F230>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BD802240C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC1EF60>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestEmployeeRetrieval.test_retrieve_employees_paginated _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestEmployeeRetrieval.test_retrieve_employee_with_relationships _

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFEC47440>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC47680>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEB77840>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC47680>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFEC46690>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEB77840>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC47680>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestEmployeeRetrieval.test_retrieve_employee_with_relationships _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_______ ERROR at setup of TestEmployeeUpdate.test_update_employee_name ________

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFEC46C60>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC46F90>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BD81874240>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC46F90>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFEC46BA0>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BD81874240>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC46F90>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
______ ERROR at teardown of TestEmployeeUpdate.test_update_employee_name ______

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_______ ERROR at setup of TestEmployeeUpdate.test_update_employee_email _______

self = <sqlalchemy.engine.base.Connection object at 0x000002BD80145670>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801458B0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEB75840>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801458B0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BD80144B60>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEB75840>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801458B0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_____ ERROR at teardown of TestEmployeeUpdate.test_update_employee_email ______

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
____ ERROR at setup of TestEmployeeUpdate.test_update_employee_department _____

self = <sqlalchemy.engine.base.Connection object at 0x000002BD80146810>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD80146DE0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BD80224CC0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD80146DE0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BD80147170>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BD80224CC0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD80146DE0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
___ ERROR at teardown of TestEmployeeUpdate.test_update_employee_department ___

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
__ ERROR at setup of TestEmployeeUpdate.test_update_employee_multiple_fields __

self = <sqlalchemy.engine.base.Connection object at 0x000002BD801CCDD0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801CD220>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BD81876340>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801CD220>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BD801CFEF0>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BD81876340>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801CD220>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestEmployeeUpdate.test_update_employee_multiple_fields _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
___ ERROR at setup of TestEmployeeUpdate.test_update_preserves_other_fields ___

self = <sqlalchemy.engine.base.Connection object at 0x000002BD801CFB30>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801CFDA0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFFF3CDC0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801CFDA0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BD801CF7D0>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFFF3CDC0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801CFDA0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestEmployeeUpdate.test_update_preserves_other_fields __

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
__________ ERROR at setup of TestEmployeeDelete.test_delete_employee __________

self = <sqlalchemy.engine.base.Connection object at 0x000002BD80165AF0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD80165EB0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEB8CE40>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD80165EB0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BD80165520>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEB8CE40>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD80165EB0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
________ ERROR at teardown of TestEmployeeDelete.test_delete_employee _________

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
___ ERROR at setup of TestEmployeeDelete.test_delete_employee_cascade_check ___

self = <sqlalchemy.engine.base.Connection object at 0x000002BD80166DE0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD80167770>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BD81874CC0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD80167770>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BD80167A40>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BD81874CC0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD80167770>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestEmployeeDelete.test_delete_employee_cascade_check __

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
__ ERROR at teardown of TestEmployeeDelete.test_delete_nonexistent_employee ___

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestEmployeeErrorHandling.test_duplicate_employee_id_error _

self = <sqlalchemy.engine.base.Connection object at 0x000002BD80126E10>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD80125B50>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEB8F540>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD80125B50>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BD801250A0>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEB8F540>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD80125B50>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestEmployeeErrorHandling.test_duplicate_employee_id_error _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestEmployeeErrorHandling.test_missing_required_organization_id _

self = <sqlalchemy.engine.base.Connection object at 0x000002BD801B04A0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801B06B0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF9B5240>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801B06B0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BD801B0200>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF9B5240>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801B06B0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestEmployeeErrorHandling.test_missing_required_organization_id _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestEmployeeErrorHandling.test_invalid_department_reference _

self = <sqlalchemy.engine.base.Connection object at 0x000002BD801B27E0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801B2DE0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEB8C7C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801B2DE0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BD801B25A0>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEB8C7C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801B2DE0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestEmployeeErrorHandling.test_invalid_department_reference _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestEmployeeErrorHandling.test_invalid_designation_reference _

self = <sqlalchemy.engine.base.Connection object at 0x000002BD801B3AD0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801ACC50>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF9B6540>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801ACC50>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BD801B1190>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF9B6540>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801ACC50>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestEmployeeErrorHandling.test_invalid_designation_reference _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
____ ERROR at setup of TestEmployeeErrorHandling.test_invalid_email_format ____

self = <sqlalchemy.engine.base.Connection object at 0x000002BD80125520>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD80125E50>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFFF3D240>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD80125E50>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BD80125DC0>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFFF3D240>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD80125E50>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
__ ERROR at teardown of TestEmployeeErrorHandling.test_invalid_email_format ___

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
____ ERROR at setup of TestEmployeeErrorHandling.test_future_date_of_birth ____

self = <sqlalchemy.engine.base.Connection object at 0x000002BD80166900>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801B2990>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BD81877C40>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801B2990>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BD80166720>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BD81877C40>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801B2990>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
__ ERROR at teardown of TestEmployeeErrorHandling.test_future_date_of_birth ___

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestEmployeeErrorHandling.test_joining_date_before_birth_date _

self = <sqlalchemy.engine.base.Connection object at 0x000002BD80146E70>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD80145790>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BD815803C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD80145790>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BD80167680>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BD815803C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD80145790>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestEmployeeErrorHandling.test_joining_date_before_birth_date _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
______ ERROR at setup of TestTransactionBehavior.test_rollback_on_error _______

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFEC1FB00>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC1FD70>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BD803B58C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC1FD70>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFEC1EF60>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BD803B58C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC1FD70>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_____ ERROR at teardown of TestTransactionBehavior.test_rollback_on_error _____

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
___ ERROR at setup of TestTransactionBehavior.test_partial_commit_isolation ___

self = <sqlalchemy.engine.base.Connection object at 0x000002BDFEB910D0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC45D60>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEB757C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC45D60>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BDFEB91790>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEB757C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BDFEC45D60>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestTransactionBehavior.test_partial_commit_isolation __

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestTransactionBehavior.test_nested_updates_in_transaction _

self = <sqlalchemy.engine.base.Connection object at 0x000002BD801AC980>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801AE270>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF9B6EC0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801AE270>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BD801AC770>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFF9B6EC0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801AE270>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestTransactionBehavior.test_nested_updates_in_transaction _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestAggregateOperations.test_count_employees_by_department _

self = <sqlalchemy.engine.base.Connection object at 0x000002BD801AE660>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801AFAA0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BD803B6540>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801AFAA0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BD801AE090>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BD803B6540>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801AFAA0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestAggregateOperations.test_count_employees_by_department _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestAggregateOperations.test_count_employees_by_organization _

self = <sqlalchemy.engine.base.Connection object at 0x000002BD801FD070>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801FD9D0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEB8C7C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801FD9D0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BD801FC350>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BDFEB8C7C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801FD9D0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestAggregateOperations.test_count_employees_by_organization _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
______ ERROR at setup of TestAggregateOperations.test_bulk_status_update ______

self = <sqlalchemy.engine.base.Connection object at 0x000002BD801FE570>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801FEF90>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BD819BC540>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801FEF90>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BD801FF590>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BD819BC540>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD801FEF90>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
____ ERROR at teardown of TestAggregateOperations.test_bulk_status_update _____

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
_ ERROR at setup of TestAggregateOperations.test_distinct_departments_in_org __

self = <sqlalchemy.engine.base.Connection object at 0x000002BD80110F80>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD80111700>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x000002BDFE8FAE70>
parameters = [('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BD802277C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD80111700>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.IntegrityError: UNIQUE constraint failed: core_organizations.code

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError

The above exception was the direct cause of the following exception:

db = <sqlalchemy.orm.session.Session object at 0x000002BD80110470>

    @pytest.fixture
    def test_org(db):
        """Create test organization"""
        org = DBOrganization(
            id="ORG_TEST",
            code="ORG_CODE",
            name="Test Organization",
            email="org@test.com",
            phone="123-456-7890",
            description="Test organization"
        )
        db.add(org)
>       db.commit()

backend\tests\test_employee_crud_expanded.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
venv\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
venv\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
venv\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
venv\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
venv\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
venv\Lib\site-packages\sqlalchemy\sql\elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
venv\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
venv\Lib\site-packages\sqlalchemy\engine\base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x000002BDFC5047D0>
cursor = <sqlite3.Cursor object at 0x000002BD802277C0>
statement = 'INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_num... ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at'
parameters = ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x000002BD80111700>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: core_organizations.code
E       [SQL: INSERT INTO core_organizations (id, code, name, is_active, enabled_modules, head_id, tax_identifier, registration_number, founded_date, email, phone, website, address_line1, address_line2, city, state, zip_code, country, logo, cover_url, industry, currency, tax_year_end, social_links, description, system_authority, approval_workflows, updated_at, created_by, updated_by) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, ?, ?) RETURNING created_at, updated_at]
E       [parameters: ('ORG_TEST', 'ORG_CODE', 'Test Organization', 1, '["hcm"]', None, None, None, None, 'org@test.com', '123-456-7890', None, None, None, None, None, None, None, None, None, None, 'PKR', None, None, 'Test organization', None, None, None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/gkpj)

venv\Lib\site-packages\sqlalchemy\engine\default.py:952: IntegrityError
_ ERROR at teardown of TestAggregateOperations.test_distinct_departments_in_org _

    @pytest.fixture(scope="function")
    def db():
        # Create the database and tables
        Base.metadata.create_all(bind=engine)
        db = TestingSessionLocal()
        try:
            yield db
        finally:
            db.close()
            # Disable foreign keys before dropping tables to avoid dependency errors
            with engine.connect() as conn:
>               conn.execute(func.text("PRAGMA foreign_keys=OFF"))
                             ^^^^
E               NameError: name 'func' is not defined

backend\tests\conftest.py:50: NameError
============================== warnings summary ===============================
backend\database\__init__.py:62
  D:\Project\PEOPLE_OS\backend\database\__init__.py:62: MovedIn20Warning: The ``declarative_base()`` function is now available as sqlalchemy.orm.declarative_base(). (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
    Base = declarative_base()

venv\Lib\site-packages\pydantic\_internal\_config.py:271: 82 warnings
  D:\Project\PEOPLE_OS\venv\Lib\site-packages\pydantic\_internal\_config.py:271: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

backend/tests/test_security_phase2.py::TestJWTTokenGeneration::test_create_access_token
backend/tests/test_security_phase2.py::TestJWTTokenGeneration::test_access_token_contains_user_data
backend/tests/test_security_phase2.py::TestJWTTokenGeneration::test_token_has_expiration
backend/tests/test_security_phase2.py::TestJWTTokenGeneration::test_token_type_validation
backend/tests/test_security_phase2.py::TestTokenRefresh::test_refresh_access_token
backend/tests/test_security_phase2.py::TestTokenRefresh::test_new_access_token_valid
backend/tests/test_security_phase2.py::TestSecurityIntegration::test_authenticated_user_with_rbac
backend/tests/test_security_phase2.py::TestSecurityIntegration::test_permission_denied_flow
  D:\Project\PEOPLE_OS\backend\security\oauth2.py:68: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    "exp": datetime.utcnow() + expires_delta,

backend/tests/test_security_phase2.py::TestJWTTokenGeneration::test_create_refresh_token
backend/tests/test_security_phase2.py::TestTokenRefresh::test_refresh_access_token
backend/tests/test_security_phase2.py::TestTokenRefresh::test_refresh_access_token
backend/tests/test_security_phase2.py::TestTokenRefresh::test_new_access_token_valid
backend/tests/test_security_phase2.py::TestTokenRefresh::test_new_access_token_valid
  D:\Project\PEOPLE_OS\backend\security\oauth2.py:98: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    "exp": datetime.utcnow() + expires_delta,

backend/tests/test_security_phase2.py::TestJWTTokenGeneration::test_token_has_expiration
  D:\Project\PEOPLE_OS\backend\tests\test_security_phase2.py:93: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    assert token_data.exp > datetime.utcnow()

backend/tests/test_security_phase2.py::TestAuditLogging::test_log_employee_create
backend/tests/test_security_phase2.py::TestAuditLogging::test_log_employee_update
backend/tests/test_security_phase2.py::TestAuditLogging::test_log_employee_delete
backend/tests/test_security_phase2.py::TestAuditLogging::test_log_role_change
backend/tests/test_security_phase2.py::TestAuditLogging::test_audit_entry_has_timestamp
backend/tests/test_security_phase2.py::TestSecurityIntegration::test_audit_logs_encrypted_data
backend/tests/test_security_phase2.py::TestSecurityIntegration::test_permission_denied_flow
  D:\Project\PEOPLE_OS\backend\security\audit_logger.py:85: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    timestamp = datetime.utcnow()

backend/tests/test_performance_phase2.py: 2023 warnings
  D:\Project\PEOPLE_OS\backend\cache\redis_manager.py:224: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    "expires": datetime.utcnow() + timedelta(seconds=ttl),

backend/tests/test_performance_phase2.py: 1814 warnings
  D:\Project\PEOPLE_OS\backend\cache\redis_manager.py:211: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    if entry["expires"] > datetime.utcnow():

backend/tests/test_performance_phase2.py::TestInMemoryCache::test_exists_key
backend/tests/test_performance_phase2.py::TestCacheManager::test_cache_manager_exists
backend/tests/test_performance_phase2.py::TestCachedQueryDecorator::test_cached_query_custom_key_builder
  D:\Project\PEOPLE_OS\backend\cache\redis_manager.py:242: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    if entry["expires"] > datetime.utcnow():

backend/tests/test_performance_phase2.py: 153 warnings
  D:\Project\PEOPLE_OS\backend\database\query_optimizer.py:47: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    "timestamp": datetime.utcnow(),

backend/tests/test_monitoring_phase2.py::TestMetricsMiddleware::test_middleware_records_request
backend/tests/test_monitoring_phase2.py::TestMetricsMiddleware::test_middleware_records_error
  D:\Project\PEOPLE_OS\venv\Lib\site-packages\httpx\_client.py:680: DeprecationWarning: The 'app' shortcut is now deprecated. Use the explicit style 'transport=WSGITransport(app=...)' instead.
    warnings.warn(message, DeprecationWarning)

backend/tests/test_protection_phase2.py: 134 warnings
  D:\Project\PEOPLE_OS\backend\protection\rate_limiter.py:65: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    now = datetime.utcnow()

backend/tests/test_protection_phase2.py: 16 warnings
  D:\Project\PEOPLE_OS\backend\protection\rate_limiter.py:139: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    now = datetime.utcnow()

backend/tests/test_protection_phase2.py::TestRateLimiter::test_rate_limiter_unconfigured_endpoint
  D:\Project\PEOPLE_OS\backend\protection\rate_limiter.py:213: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    reset_time=datetime.utcnow() + timedelta(hours=1),

backend/tests/test_protection_phase2.py: 10 warnings
  <string>:7: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).

backend/tests/test_protection_phase2.py::TestDDoSProtector::test_ddos_check_ip_safe
backend/tests/test_protection_phase2.py::TestDDoSProtector::test_ddos_record_request
backend/tests/test_protection_phase2.py::TestDDoSProtector::test_ddos_record_error
backend/tests/test_protection_phase2.py::TestDDoSProtector::test_ddos_block_ip
backend/tests/test_protection_phase2.py::TestDDoSProtector::test_ddos_permanent_blacklist
backend/tests/test_protection_phase2.py::TestDDoSProtector::test_ddos_whitelist_ip
backend/tests/test_protection_phase2.py::TestDDoSProtector::test_ddos_threat_summary
backend/tests/test_protection_phase2.py::TestDDoSProtector::test_ddos_error_rate_escalation
backend/tests/test_protection_phase2.py::TestDDoSIntegration::test_ddos_escalation_chain
  D:\Project\PEOPLE_OS\backend\protection\ddos_protection.py:80: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    self.last_cleanup = datetime.utcnow()

backend/tests/test_protection_phase2.py: 205 warnings
  D:\Project\PEOPLE_OS\backend\protection\ddos_protection.py:118: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    stats.last_request = datetime.utcnow()

backend/tests/test_protection_phase2.py: 205 warnings
  D:\Project\PEOPLE_OS\backend\protection\ddos_protection.py:213: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    if (datetime.utcnow() - self.last_cleanup).total_seconds() < self.config.cleanup_interval:

backend/tests/test_protection_phase2.py: 10 warnings
  D:\Project\PEOPLE_OS\backend\protection\ddos_protection.py:191: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    ban_until = datetime.utcnow() + timedelta(seconds=self.config.temporary_ban_duration)

backend/tests/test_protection_phase2.py::TestDDoSProtector::test_ddos_block_ip
  D:\Project\PEOPLE_OS\backend\protection\ddos_protection.py:92: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    if datetime.utcnow() < ban_time:

backend/tests/test_protection_phase2.py::TestDDoSProtector::test_ddos_block_ip
  D:\Project\PEOPLE_OS\backend\protection\ddos_protection.py:93: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    remaining = int((ban_time - datetime.utcnow()).total_seconds())

backend/tests/test_security_scanning_phase2.py::TestSecurityReport::test_metrics_creation
  D:\Project\PEOPLE_OS\backend\tests\test_security_scanning_phase2.py:387: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    timestamp=datetime.utcnow().isoformat()

backend/tests/test_security_scanning_phase2.py::TestSecurityReport::test_metrics_as_dict
  D:\Project\PEOPLE_OS\backend\tests\test_security_scanning_phase2.py:395: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    timestamp = datetime.utcnow().isoformat()

backend/tests/test_security_scanning_phase2.py::TestSecurityReport::test_summary_generation
  D:\Project\PEOPLE_OS\backend\tests\test_security_scanning_phase2.py:425: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    timestamp=datetime.utcnow().isoformat()

backend/tests/test_security_scanning_phase2.py::TestSecurityReport::test_summary_generation
  D:\Project\PEOPLE_OS\backend\tests\test_security_scanning_phase2.py:427: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    report.generated_at = datetime.utcnow().isoformat()

backend/tests/test_security_scanning_phase2.py::TestSecurityReport::test_json_export_format
  D:\Project\PEOPLE_OS\backend\tests\test_security_scanning_phase2.py:446: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    'generated_at': datetime.utcnow().isoformat(),

backend/tests/test_security_scanning_phase2.py::TestSecurityReport::test_json_export_format
  D:\Project\PEOPLE_OS\backend\tests\test_security_scanning_phase2.py:458: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    'timestamp': datetime.utcnow().isoformat()

backend/tests/test_security_scanning_phase2.py::TestSecurityReport::test_markdown_export_format
  D:\Project\PEOPLE_OS\backend\tests\test_security_scanning_phase2.py:475: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    'generated_at': datetime.utcnow().isoformat(),

backend/tests/test_security_scanning_phase2.py::TestSecurityReport::test_html_export_format
  D:\Project\PEOPLE_OS\backend\tests\test_security_scanning_phase2.py:510: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    'generated_at': datetime.utcnow().isoformat(),

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
ERROR backend/tests/test_department_crud.py::TestDepartmentCreation::test_create_department_basic
ERROR backend/tests/test_department_crud.py::TestDepartmentCreation::test_create_department_with_description
ERROR backend/tests/test_department_crud.py::TestDepartmentCreation::test_create_department_with_description
ERROR backend/tests/test_department_crud.py::TestDepartmentCreation::test_create_subdepartment
ERROR backend/tests/test_department_crud.py::TestDepartmentCreation::test_create_subdepartment
ERROR backend/tests/test_department_crud.py::TestDepartmentCreation::test_create_nested_subdepartments
ERROR backend/tests/test_department_crud.py::TestDepartmentCreation::test_create_nested_subdepartments
ERROR backend/tests/test_department_crud.py::TestDepartmentCreation::test_create_multiple_departments_same_org
ERROR backend/tests/test_department_crud.py::TestDepartmentCreation::test_create_multiple_departments_same_org
ERROR backend/tests/test_department_crud.py::TestDepartmentCreation::test_department_unique_per_organization
ERROR backend/tests/test_department_crud.py::TestDepartmentCreation::test_department_unique_per_organization
ERROR backend/tests/test_department_crud.py::TestDepartmentRetrieval::test_retrieve_department_by_id
ERROR backend/tests/test_department_crud.py::TestDepartmentRetrieval::test_retrieve_department_by_id
ERROR backend/tests/test_department_crud.py::TestDepartmentRetrieval::test_retrieve_all_departments_in_org
ERROR backend/tests/test_department_crud.py::TestDepartmentRetrieval::test_retrieve_all_departments_in_org
ERROR backend/tests/test_department_crud.py::TestDepartmentRetrieval::test_retrieve_department_not_found
ERROR backend/tests/test_department_crud.py::TestDepartmentRetrieval::test_retrieve_subdepartments
ERROR backend/tests/test_department_crud.py::TestDepartmentRetrieval::test_retrieve_subdepartments
ERROR backend/tests/test_department_crud.py::TestDepartmentRetrieval::test_retrieve_department_with_employees
ERROR backend/tests/test_department_crud.py::TestDepartmentRetrieval::test_retrieve_department_with_employees
ERROR backend/tests/test_department_crud.py::TestDepartmentUpdate::test_update_department_name
ERROR backend/tests/test_department_crud.py::TestDepartmentUpdate::test_update_department_name
ERROR backend/tests/test_department_crud.py::TestDepartmentUpdate::test_update_department_code
ERROR backend/tests/test_department_crud.py::TestDepartmentUpdate::test_update_department_code
ERROR backend/tests/test_department_crud.py::TestDepartmentUpdate::test_update_department_description
ERROR backend/tests/test_department_crud.py::TestDepartmentUpdate::test_update_department_description
ERROR backend/tests/test_department_crud.py::TestDepartmentDelete::test_delete_empty_department
ERROR backend/tests/test_department_crud.py::TestDepartmentDelete::test_delete_empty_department
ERROR backend/tests/test_department_crud.py::TestDepartmentDelete::test_delete_department_cascade_check
ERROR backend/tests/test_department_crud.py::TestDepartmentDelete::test_delete_department_cascade_check
ERROR backend/tests/test_department_crud.py::TestDepartmentErrorHandling::test_missing_required_organization
ERROR backend/tests/test_department_crud.py::TestDepartmentErrorHandling::test_invalid_parent_subdepartment
ERROR backend/tests/test_department_crud.py::TestDepartmentErrorHandling::test_department_unicode_name
ERROR backend/tests/test_department_crud.py::TestDepartmentErrorHandling::test_department_unicode_name
ERROR backend/tests/test_department_crud.py::TestDepartmentErrorHandling::test_circular_subdepartment_reference
ERROR backend/tests/test_department_crud.py::TestDepartmentErrorHandling::test_circular_subdepartment_reference
ERROR backend/tests/test_job_levels_grades.py::TestJobLevelCreation::test_create_job_level_basic
ERROR backend/tests/test_job_levels_grades.py::TestJobLevelCreation::test_create_job_level_hierarchy
ERROR backend/tests/test_job_levels_grades.py::TestJobLevelCreation::test_create_job_level_hierarchy
ERROR backend/tests/test_job_levels_grades.py::TestJobLevelCreation::test_retrieve_job_level_by_number
ERROR backend/tests/test_job_levels_grades.py::TestJobLevelCreation::test_retrieve_job_level_by_number
ERROR backend/tests/test_job_levels_grades.py::TestJobLevelCreation::test_job_level_numeric_order
ERROR backend/tests/test_job_levels_grades.py::TestJobLevelCreation::test_job_level_numeric_order
ERROR backend/tests/test_job_levels_grades.py::TestGradeCreation::test_create_grade_basic
ERROR backend/tests/test_job_levels_grades.py::TestGradeCreation::test_create_grade_basic
ERROR backend/tests/test_job_levels_grades.py::TestGradeCreation::test_create_multiple_grades
ERROR backend/tests/test_job_levels_grades.py::TestGradeCreation::test_create_multiple_grades
ERROR backend/tests/test_job_levels_grades.py::TestGradeCreation::test_retrieve_grade_by_level
ERROR backend/tests/test_job_levels_grades.py::TestGradeCreation::test_retrieve_grade_by_level
ERROR backend/tests/test_job_levels_grades.py::TestGradeCreation::test_grade_organization_isolation
ERROR backend/tests/test_job_levels_grades.py::TestGradeCreation::test_grade_organization_isolation
ERROR backend/tests/test_job_levels_grades.py::TestDesignationCreation::test_create_designation_basic
ERROR backend/tests/test_job_levels_grades.py::TestDesignationCreation::test_create_designation_basic
ERROR backend/tests/test_job_levels_grades.py::TestDesignationCreation::test_create_designation_with_levels
ERROR backend/tests/test_job_levels_grades.py::TestDesignationCreation::test_create_designation_with_levels
ERROR backend/tests/test_job_levels_grades.py::TestDesignationCreation::test_retrieve_designation_by_department
ERROR backend/tests/test_job_levels_grades.py::TestDesignationCreation::test_retrieve_designation_by_department
ERROR backend/tests/test_job_levels_grades.py::TestDesignationCreation::test_designation_grade_relationship
ERROR backend/tests/test_job_levels_grades.py::TestDesignationCreation::test_designation_grade_relationship
ERROR backend/tests/test_job_levels_grades.py::TestJobDesignationRelationships::test_designation_requires_grade
ERROR backend/tests/test_job_levels_grades.py::TestJobDesignationRelationships::test_designation_requires_grade
ERROR backend/tests/test_job_levels_grades.py::TestJobDesignationRelationships::test_designation_requires_department
ERROR backend/tests/test_job_levels_grades.py::TestJobDesignationRelationships::test_designation_requires_department
ERROR backend/tests/test_job_levels_grades.py::TestJobDesignationRelationships::test_employee_with_designation
ERROR backend/tests/test_job_levels_grades.py::TestJobDesignationRelationships::test_employee_with_designation
ERROR backend/tests/test_job_levels_grades.py::TestJobDesignationRelationships::test_job_level_grade_mapping
ERROR backend/tests/test_job_levels_grades.py::TestJobDesignationRelationships::test_job_level_grade_mapping
ERROR backend/tests/test_job_levels_grades.py::TestJobDesignationErrorHandling::test_duplicate_designation_code
ERROR backend/tests/test_job_levels_grades.py::TestJobDesignationErrorHandling::test_duplicate_designation_code
ERROR backend/tests/test_job_levels_grades.py::TestJobDesignationErrorHandling::test_negative_grade_level
ERROR backend/tests/test_job_levels_grades.py::TestJobDesignationErrorHandling::test_negative_grade_level
ERROR backend/tests/test_job_levels_grades.py::TestJobDesignationErrorHandling::test_zero_job_level_number
ERROR backend/tests/test_job_levels_grades.py::TestJobDesignationErrorHandling::test_zero_job_level_number
ERROR backend/tests/test_job_levels_grades.py::TestJobDesignationErrorHandling::test_very_long_designation_name
ERROR backend/tests/test_job_levels_grades.py::TestJobDesignationErrorHandling::test_very_long_designation_name
ERROR backend/tests/test_job_levels_grades.py::TestJobDesignationErrorHandling::test_special_characters_in_code
ERROR backend/tests/test_job_levels_grades.py::TestJobDesignationErrorHandling::test_special_characters_in_code
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeCreation::test_create_employee_basic
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeCreation::test_create_employee_basic
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeCreation::test_create_employee_with_optional_fields
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeCreation::test_create_employee_with_optional_fields
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeCreation::test_create_multiple_employees_same_org
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeCreation::test_create_multiple_employees_same_org
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeCreation::test_employee_default_status
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeCreation::test_employee_default_status
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeCreation::test_create_employee_unicode_name
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeCreation::test_create_employee_unicode_name
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeCreation::test_create_employee_email_case_sensitivity
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeCreation::test_create_employee_email_case_sensitivity
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeRetrieval::test_retrieve_employee_by_id
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeRetrieval::test_retrieve_employee_by_id
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeRetrieval::test_retrieve_employee_not_found
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeRetrieval::test_retrieve_employees_by_department
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeRetrieval::test_retrieve_employees_by_department
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeRetrieval::test_retrieve_employees_by_organization
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeRetrieval::test_retrieve_employees_by_organization
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeRetrieval::test_retrieve_employees_paginated
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeRetrieval::test_retrieve_employees_paginated
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeRetrieval::test_retrieve_employee_with_relationships
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeRetrieval::test_retrieve_employee_with_relationships
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeUpdate::test_update_employee_name
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeUpdate::test_update_employee_name
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeUpdate::test_update_employee_email
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeUpdate::test_update_employee_email
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeUpdate::test_update_employee_department
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeUpdate::test_update_employee_department
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeUpdate::test_update_employee_multiple_fields
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeUpdate::test_update_employee_multiple_fields
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeUpdate::test_update_preserves_other_fields
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeUpdate::test_update_preserves_other_fields
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeDelete::test_delete_employee
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeDelete::test_delete_employee
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeDelete::test_delete_employee_cascade_check
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeDelete::test_delete_employee_cascade_check
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeDelete::test_delete_nonexistent_employee
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeErrorHandling::test_duplicate_employee_id_error
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeErrorHandling::test_duplicate_employee_id_error
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeErrorHandling::test_missing_required_organization_id
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeErrorHandling::test_missing_required_organization_id
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeErrorHandling::test_invalid_department_reference
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeErrorHandling::test_invalid_department_reference
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeErrorHandling::test_invalid_designation_reference
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeErrorHandling::test_invalid_designation_reference
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeErrorHandling::test_invalid_email_format
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeErrorHandling::test_invalid_email_format
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeErrorHandling::test_future_date_of_birth
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeErrorHandling::test_future_date_of_birth
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeErrorHandling::test_joining_date_before_birth_date
ERROR backend/tests/test_employee_crud_expanded.py::TestEmployeeErrorHandling::test_joining_date_before_birth_date
ERROR backend/tests/test_employee_crud_expanded.py::TestTransactionBehavior::test_rollback_on_error
ERROR backend/tests/test_employee_crud_expanded.py::TestTransactionBehavior::test_rollback_on_error
ERROR backend/tests/test_employee_crud_expanded.py::TestTransactionBehavior::test_partial_commit_isolation
ERROR backend/tests/test_employee_crud_expanded.py::TestTransactionBehavior::test_partial_commit_isolation
ERROR backend/tests/test_employee_crud_expanded.py::TestTransactionBehavior::test_nested_updates_in_transaction
ERROR backend/tests/test_employee_crud_expanded.py::TestTransactionBehavior::test_nested_updates_in_transaction
ERROR backend/tests/test_employee_crud_expanded.py::TestAggregateOperations::test_count_employees_by_department
ERROR backend/tests/test_employee_crud_expanded.py::TestAggregateOperations::test_count_employees_by_department
ERROR backend/tests/test_employee_crud_expanded.py::TestAggregateOperations::test_count_employees_by_organization
ERROR backend/tests/test_employee_crud_expanded.py::TestAggregateOperations::test_count_employees_by_organization
ERROR backend/tests/test_employee_crud_expanded.py::TestAggregateOperations::test_bulk_status_update
ERROR backend/tests/test_employee_crud_expanded.py::TestAggregateOperations::test_bulk_status_update
ERROR backend/tests/test_employee_crud_expanded.py::TestAggregateOperations::test_distinct_departments_in_org
ERROR backend/tests/test_employee_crud_expanded.py::TestAggregateOperations::test_distinct_departments_in_org
========== 209 passed, 4699 warnings, 143 errors in 66.12s (0:01:06) ==========
